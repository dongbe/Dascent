"use strict";angular.module("dascentApp",["ngNotificationsBar","ngCookies","ngResource","ngSanitize","angular-loading-bar","btford.socket-io","ui.router","ui.bootstrap","uiGmapgoogle-maps","vcRecaptcha","ngFileUpload"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","uiGmapGoogleMapApiProvider","cfpLoadingBarProvider",function(a,b,c,d,e,f){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor"),e.configure({v:"3.17",libraries:"weather,geometry,visualization"}),f.includeSpinner=!0}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(901===a.data.code?console.log("datavenue access denied"):(d.path("/"===d.path()?"/":"/login"),c.remove("token")),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(a){"/"===b.path()&&a?b.path("/moncompte"):d.authenticate&&!a?b.path("/"):!d.access&&a?b.path(d.url):c.isAuthorized("admin")&&a?b.path("/admin"):c.isAuthorized("constructor")&&a?b.path("/constructor"):"user"===d.access&&c.isAuthorized("user")?b.path(d.url):c.isAuthorized(d.access)||b.path("/login")})})}]),angular.module("dascentApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]),angular.module("dascentApp").controller("LoginCtrl",["$scope","Auth","$location","notifications",function(a,b,c,d){a.user={},a.errors={},a.login=function(e){a.submitted=!0,e.$valid?b.login({email:a.user.mail,password:a.user.pword}).then(function(){c.path("/moncompte")})["catch"](function(a){c.path("/login"),d.showError(a.message+"Check your credentials and try again")}):(d.showWarning("Login error: Check your credentials and try again"),c.path("/login"))}}]),angular.module("dascentApp").controller("SettingsCtrl",["$scope","User","Auth","notifications","Upload",function(a,b,c,d,e){a.errors={},a.user=c.getCurrentUser(),a.isConstructor=c.isConstructor(),a.uploadedImage={},a["new"]={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed.",a.pwd=!1})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})},a.update=function(b){a.submitted=!0,b.$valid&&(a.isConstructor?c.updateProvider({name:a.user.name,lastname:a.user.lastname,email:a.user.email}).then(function(){d.showSuccess("Account successfully updated!!")})["catch"](function(c){c=c.data,a.errors={},a.response=!1,angular.forEach(c.errors,function(c,d){b[d].$setValidity("mongoose",!1),a.errors[d]=c.message})}):c.update({name:a.user.name,lastname:a.user.lastname,email:a.user.email,isskey:user.isskey,idclient:user.idclient}).then(function(){d.showSuccess("Account successfully updated!!")})["catch"](function(c){c=c.data,a.errors={},a.response=!1,angular.forEach(c.errors,function(c,d){b[d].$setValidity("mongoose",!1),a.errors[d]=c.message})}))},a.onFileSelect=function(b){return"image/png"!==b.type&&"image/jpeg"!==b.type?void d.showError("Only PNG and JPEG are accepted."):(a.uploadInProgress=!0,a.uploadProgress=0,void(a.upload=e.upload({url:"/api/users/"+a.user._id+"/avatar",method:"POST",file:b}).progress(function(b){a.uploadProgress=Math.floor(b.loaded/b.total)}).success(function(b){a.uploadInProgress=!1,a.user.avatar=b,a.imageSrc=null}).error(function(b){a.uploadInProgress=!1,console.log("Error uploading file: "+b.message||b)})))}}]).directive("ngFileSelect",function(){return{link:function(a,b){b.bind("change",function(b){var c=new FileReader;c.onload=function(b){a.$apply(function(){a.imageSrc=b.target.result})},a.files=b.target.files[0],c.readAsDataURL(b.target.files[0])})}}}),angular.module("dascentApp").controller("SignupCtrl",["$http","$scope","Auth","$location","notifications","vcRecaptchaService",function(a,b,c,d,e,f){b.user={},b.errors={},b.key="6Ld4yAsTAAAAANGQPzVj6fawkajObhMZaQ5OCbK0",b.response=!0,b.setResponse=function(){b.response=!0},b.setWidgetId=function(a){b.widgetId=a},b.register=function(a){b.submitted=!0;var g=f?f.getResponse(b.widgetId):"";b.response=g.length<1?!1:!0,a.$valid&&g&&(b.user.password1===b.user.password2?c.createUser({name:b.user.name,lastname:b.user.lastname,email:b.user.email,password:b.user.password1,key:g}).then(function(){e.showSuccess("Account successfully created!!"),d.path("/login")})["catch"](function(c){c=c.data,b.errors={},b.response=!1,f.reload(b.widgetId),angular.forEach(c.errors,function(c,d){a[d].$setValidity("mongoose",!1),b.errors[d]=c.message})}):e.showError("password not good"))},b.registerPro=function(a){b.submitted=!0;var g=f.getResponse(b.widgetId);b.response=g.length<1?!1:!0,a.$valid&&g&&(b.user.password1===b.user.password2?c.createUser({name:b.user.name,isskey:b.user.isskey,idclient:b.user.idclient,email:b.user.email,password:b.user.password1,key:g}).then(function(){e.showSuccess("Account successfully created!!"),d.path("/login")})["catch"](function(c){c=c.data,b.errors={},b.response=!1,f.reload(b.widgetId),angular.forEach(c.errors,function(c,d){a[d].$setValidity("mongoose",!1),b.errors[d]=c.message})}):e.showError("password not good"))}}]),angular.module("dascentApp").controller("MainCtrl",["$scope",function(){}]),angular.module("dascentApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("dascentApp").config(["$stateProvider",function(a){a.state("device",{url:"/device",templateUrl:"app/profil/device/device.html",controller:"SideBarCtrl",access:"user"})}]),angular.module("dascentApp").config(["$stateProvider",function(a){a.state("follower/",{url:"/follower",templateUrl:"app/profil/follower/follower.html",controller:"SideBarCtrl",access:"user",authenticate:!0})}]),angular.module("dascentApp").config(["$stateProvider",function(a){a.state("moncompte",{url:"/moncompte",templateUrl:"app/profil/moncompte/moncompte.html",controller:"SideBarCtrl",authenticate:!0,access:"user"})}]),angular.module("dascentApp").controller("SideBarCtrl",["$q","$scope","$location","Auth","$http","ManDev","socket","notifications","uiGmapGoogleMapApi","uiGmapIsReady",function(a,b,c,d,e,f,g,h,i,j){b.followings=[],b.currentUser=d.getCurrentUser,b.profile=[],b.device={},b.points=[],b.polylines=[],b.control={},b.gps=!1;var k=!1;e.get("/api/users/"+b.currentUser()._id+"/profiles").success(function(a){b.profile=a,g.syncProfileUpdates("profile",b.profile),g.syncDevUpdates("device",b.profile.watchs);var c=!1;for(var d in b.profile.watchs){if(b.profile.watchs[d].device.group.indexOf("GPS")>-1){var e={},f={},h={};h.path=[];var i=[],j=!0;angular.forEach(b.profile.watchs[d].device.streams,function(a){if(a.lastValue&&"GPS"===a.name?(e.latitude=a.lastValue.latitude,e.longitude=a.lastValue.longitude,a.values.length>1&&(i=a.values),f.coords=e,f.id=b.points.length>0?b.points.length:0,f.options={draggable:!1,labelContent:b.profile.watchs[d].device.name,labelAnchor:"22 0",labelClass:"marker-labels"}):j=!1,i.length>0){h.id=b.polylines.length>0?b.polylines.length+1:1;for(var c in i)h.path.push(i[c].value);h.stroke={color:"#6060FB",weight:3},h.editable=!0,h.visible=!0,b.polylines.push(h)}}),j&&(b.gps=!0,b.points.push(f))}if(b.profile.watchs[d].type===!1){for(var k in b.followings)b.followings[k]===b.profile.watchs[d].device._owner&&(c=!0);c||b.followings.push(b.profile.watchs[d].device._owner),c=!1}}}).error(function(a){console.log(a)}).then(function(){i.then(function(a){a.visualRefresh=!0;var c=b.points.length?b.points[b.points.length-1]:{};b.map=c?{center:{latitude:45.2002,longitude:5.7222},zoom:16,pan:1}:{},j.promise().then(function(a){var c=a[0].map;b.bounds=new google.maps.LatLngBounds;for(var d=0;d<b.points.length-1;d++)b.bounds.extend(new google.maps.LatLng(b.points[d].coords));console.log(b.bounds),c.fitBounds(b.bounds)})})}),b.type=function(a){return a.type},b.isGPS=function(a){return a.device.group.indexOf("GPS")>-1?!0:!1},b.deleteDevice=function(a){console.log(a._id),e.post("/api/profiles/"+b.currentUser()._profile+"/deletedevice/"+a._id).success(function(a){console.log(a)}).error(function(a){console.log(a)}),angular.forEach(b.profile.watchs,function(c,d){c===a&&b.profile.watchs.splice(d,1)})},b.isActive=function(a){return a===c.path()},b.register=function(){angular.forEach(b.profile.watchs,function(a){a.device.serial===b.device.serial&&(k=!0)}),k?h.showError("Vous avez deja souscrit à ce capteur"):f.addDevice({serial:b.device.serial}).then(function(a){b.profile.waiting.push(a),h.showSuccess("Demande envoyé!")})["catch"](function(a){h.showError("Oops! Device "+a)}),k=!1,b.device={}},b.registerO=function(){angular.forEach(b.profile.watchs,function(a){a.device.serial===b.device.serial&&a._owner===b.currentUser._id&&(k=!0)}),k?h.showError("Vous etes dèja proprietaire de ce capteur"):f.addDevice({serial:b.device.serial,password:b.device.pass}).then(function(a){b.profile.watchs.push({device:a,type:!0}),h.showSuccess("Capteur enregistré!")})["catch"](function(a){h.showError("Oops! Device "+a)}),k=!1,b.device={}},b.confirm=function(a){f.confirm({id:b.profile._id,demand:a}).then(function(){h.showSuccess("Félicitations, vous avez un nouveau suiveur!")})["catch"](function(a){console.log(a)})},b.discard=function(a){f.discard({id:b.profile._id,demand:a}).then(function(){angular.forEach(b.profile.accepted,function(c,d){c===a&&b.profile.accepted.splice(d,1)}),h.showSuccess("Vous venez de revoquer un suiveur!")})["catch"](function(a){console.log(a)})},b.cancel=function(a){f.cancel({id:b.profile._id,demand:a}).then(function(){angular.forEach(b.profile.waiting,function(c,d){c===a&&b.profile.waiting.splice(d,1)})})["catch"](function(a){console.log(a)})},b.cancelR=function(a){f.cancelRequest({id:b.profile._id,demand:a}).then(function(){angular.forEach(b.profile.waiting,function(c,d){c===a&&b.profile.waiting.splice(d,1)})})["catch"](function(a){console.log(a)})},b.activateTracking=function(a){a.tracking=!0,f.updateDevice(a).then(function(){})},b.deactivateTracking=function(a){a.tracking=!1,f.updateDevice(a).then(function(){})},b.markers2=[{id:1,icon:"assets/images/blue_marker.png",latitude:46,longitude:-77,showWindow:!1,options:{labelContent:"[46,-77]",labelAnchor:"22 0",labelClass:"marker-labels"}},{id:2,icon:"assets/images/blue_marker.png",latitude:33,longitude:-77,showWindow:!1,options:{labelContent:"DRAG ME!",labelAnchor:"22 0",labelClass:"marker-labels",draggable:!0}},{id:3,icon:"assets/images/blue_marker.png",latitude:35,longitude:-125,showWindow:!1,options:{labelContent:"[35,-125]",labelAnchor:"22 0",labelClass:"marker-labels"}}],b.notif=function(){if(b.profile.length)return!1;for(var a in b.profile.watchs)for(var c in b.profile.watchs[a].device.streams)if(b.profile.watchs[a].device.streams[c].lastValue)return!0;return!1},g.unsyncUpdates("profile"),g.unsyncUpdates("device")}]).directive("loraReader",["$window","$compile",function(a,b){return{scope:{loraReader:"="},link:function(c,d){for(var e=a.d3,f=[],g=0;g<=c.loraReader.length-2;g+=2)f.push(parseInt(c.loraReader.slice(g,g+2),16));var h="<div class='row'><div class='col-md-2'>LED: "+f[0]+"</div><div class='col-md-3'>Pression: "+(f[1]+f[2])/10+" hPa</div><div class='col-md-3'>Temperature: "+(f[3]+f[4])/100+" °C</div><div class='col-md-4'><div id='chart' class='battery' style='width:100px;' ></div></div></div>";b(h)(c),d.append(h),e.select("#chart").append("div").attr("class","left").transition().ease("elastic").style("width",f[7]+"px").text(f[7]+"%")}}}]),angular.module("dascentApp").controller("ConstructorCtrl",["$scope","Auth","$timeout","ManDev","$state","$http","socket","Modal","cfpLoadingBar","notifications",function(a,b,c,d,e,f,g,h,i,j){a.constructor=b.getCurrentUser,a.importDevice=!1,a.toggle=!0,a.disable=!1,a.devices=[],f.get("/api/users/"+a.constructor()._id+"/devices").success(function(b){a.devices=b,g.syncUpdates("device",a.devices)}).error(),a.devices.length&&(a.disable=!0),a.createDevice=function(b){b?h.confirm.browse(function(a){var b;b=a.split("\n");for(var c=1;c<b.length;c++){var f=b[c].split(",");d.createDevice({name:f[0],description:f[1],serial:f[2],templateId:f[3],group:[f[4]]})}e.go("construct")}):a.error.message="veuillez choisir un fichier!!"},a.getDevices=function(){a.importDevice=!0,d.importDevice().then(function(){e.go("construct"),a.importDevice=!1})["catch"](function(a){if(a){var b=a.message;j.showError("Datavenue: "+b)}else j.showError("No internet connection")})},a.getStDevices=function(){a.importDevice=!0,d.importStDevice().then(function(){e.go("construct"),a.importDevice=!1})["catch"](function(a){a?(a=a.data,console.log(a)):j.showError("No internet connection")})},a["delete"]=function(b){f["delete"]("/api/devices/"+b._id),angular.forEach(a.devices,function(c,d){c===b&&a.devices.splice(d,1)})},a.$on("$destroy",function(){g.unsyncUpdates("device")})}]).directive("fileReader",function(){return{scope:{fileReader:"="},link:function(a,b){$(b).on("change",function(b){var c=b.target.files;if(c.length){var d=new FileReader;d.onload=function(b){var c=b.target.result;a.$apply(function(){a.fileReader=c})},d.readAsText(c[0])}})}}}),angular.module("dascentApp").config(["$stateProvider",function(a){a.state("construct",{url:"/constructor",templateUrl:"app/provider/constructor.html",controller:"ConstructorCtrl",authenticate:!0,access:"constructor"})}]),angular.module("dascentApp").factory("Auth",["$location","$http","User","$cookieStore","$q",function(a,b,c,d,e){var f={};return d.get("token")&&(f=c.get()),{login:function(a,g){var h=g||angular.noop,i=e.defer();return b.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return d.put("token",a.token),f=c.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},logout:function(){d.remove("token"),f={}},createUser:function(a,b){var d=b||angular.noop;return c.save(a,function(){return d(a)},function(a){return this.logout(),d(a)}.bind(this)).$promise},changePassword:function(a,b,d){var e=d||angular.noop;return c.changePassword({id:f._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},update:function(a,b){var d=b||angular.noop;return c.patch({id:f._id},{name:a.name,lastname:a.lastname,email:a.email},function(a){return d(a)},function(a){return d(a)}).$promise},updateProvider:function(a,b){var d=b||angular.noop;return c.patch({id:f._id},{name:a.name,lastname:a.lastname,email:a.email,isskey:a.isskey,idclient:a.idclient},function(a){return d(a)},function(a){return d(a)}).$promise},getCurrentUser:function(){return f},isLoggedIn:function(){return f.hasOwnProperty("role")},isLoggedInAsync:function(a){f.hasOwnProperty("$promise")?f.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(f.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===f.role},isConstructor:function(){return"constructor"===f.role},getToken:function(){return d.get("token")},isAuthorized:function(a){return f.role===a}}}]),angular.module("dascentApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}},patch:{method:"PATCH"},getDevices:{method:"GET",params:{id:"me",controller:"devices"},isArray:!0}})}]),angular.module("dascentApp").directive("chart",["$window","cfpLoadingBar",function(a){return{scope:{chartData:"="},template:'<div id="chartDraw"  class="col-md-6" width="500" ></div><div id="chart" class="col-md-4 col-md-offset-2"></div>',link:function(b){var c=0,d=!1,e=a.d3,f=250,g=250,h=g/2,i=[],j={},k={},l=e.scale.category10(),m=[{name:"unknown",total:0,used:0}];if(b.$on("cfpLoadingBar:completed",function(){if(c++,b.$parent.devices&&2===c&&!d){b.$parent.importDevice=!1;for(var a in b.$parent.devices)b.$parent.devices[a].group?(j=_.find(m,{name:b.$parent.devices[a].group[0]}),void 0!==j?j.total++:m.push({name:b.$parent.devices[a].group[0],total:1})):m[0].total=m[0].total+1,b.$parent.devices[a].hasOwnProperty("_owner")?(j=_.find(m,{name:b.$parent.devices[a].group[0]}),j.used++,k=_.find(i,{label:"Used"}),void 0===k?i.push({label:"Used",value:1}):k.value++):(k=_.find(i,{label:"Unused"}),void 0===k?i.push({label:"Unused",value:1}):k.value++);var n=e.scale.linear().domain([0,b.$parent.devices.length]).range([0,500]);e.select("#chartDraw").append("div").attr("class","chart").selectAll("div").data(m).enter().append("text").attr("class","left").text(function(a){return a.name}).append("div").style("width",function(a){return n(a.total)+"px"}).text(function(a){return a.total}).append("div").attr("class","charty").style("background-color","#09990d").style("width",function(a){return n(a.used)+"px"}).text(function(a){return a.used});var o=e.select("#chart").append("svg:svg").data([i]).attr("width",f).attr("height",g).append("svg:g").attr("transform","translate("+h+","+h+")"),p=e.layout.pie().value(function(a){return a.value}),q=e.svg.arc().outerRadius(h),r=o.selectAll("g.slice").data(p).enter().append("svg:g").attr("class","slice");r.append("svg:path").attr("fill",function(a,b){return l(b+2)}).attr("d",function(a){return q(a)}),r.append("svg:text").attr("transform",function(a){return a.innerRadius=0,a.outerRadius=h,"translate("+q.centroid(a)+")"}).attr("text-anchor","middle").text(function(a,b){return i[b].value+" "+i[b].label+" devices"})}}),b.$parent.devices&&0===c&&!b.$parent.importDevice){d=!0;for(var n in b.$parent.devices){if(b.$parent.devices[n].group){var j=_.find(m,{name:b.$parent.devices[n].group[0]});void 0!==j?j.total++:m.push({name:b.$parent.devices[n].group[0],total:1,used:0})}else m[0].total=m[0].total+1;if(b.$parent.devices[n].hasOwnProperty("_owner")){var j=_.find(m,{name:b.$parent.devices[n].group[0]});j.used++;var k=_.find(i,{label:"Used"});void 0===k?i.push({label:"Used",value:1}):k.value++}else{var k=_.find(i,{label:"Unused"});void 0===k?i.push({label:"Unused",value:1}):k.value++}}var o=e.scale.linear().domain([0,b.$parent.devices.length]).range([0,500]);e.select("#chartDraw").append("div").attr("class","chart").selectAll("div").data(m).enter().append("text").attr("class","left").text(function(a){return a.name}).append("div").style("width",function(a){return o(a.total)+"px"}).text(function(a){return a.total}).append("div").attr("class","charty").style("background-color","#09990d").style("width",function(a){return o(a.used)+"px"}).text(function(a){return a.used});var p=e.select("#chart").append("svg:svg").data([i]).attr("width",f).attr("height",g).append("svg:g").attr("transform","translate("+h+","+h+")"),q=e.layout.pie().value(function(a){return a.value}),r=e.svg.arc().outerRadius(h),s=p.selectAll("g.slice").data(q).enter().append("svg:g").attr("class","slice");s.append("svg:path").attr("fill",function(a,b){return l(b+2)}).attr("d",function(a){return r(a)}),s.append("svg:text").attr("transform",function(a){return a.innerRadius=0,a.outerRadius=h,"translate("+r.centroid(a)+")"}).attr("text-anchor","middle").text(function(a,b){return i[b].value+" "+i[b].label+" devices"})}}}}]),angular.module("dascentApp").factory("ManDev",["$q","$cookieStore","$http","User","Auth",function(a,b,c,d,e){var f=[],g={},h={};return{config:function(){e.isLoggedIn()&&!e.isAdmin()&&(g=e.getCurrentUser()),g&&e.isLoggedIn()&&(h={headers:{"X-ISS-Key":g.isskey,"X-OAPI-Key":g.idclient,"Content-Type":"application/json"}})},confirm:function(b,d){var e=d||angular.noop,f=a.defer();return console.log("ici"),c.post("/api/profiles/"+b.id+"/confirm",{user:b.demand.user._id,device:b.demand.device._id}).success(function(a){return f.resolve(a),e(a)}).error(function(a){return f.reject(a),e(a)}.bind(this)),f.promise},cancel:function(b,d){var e=d||angular.noop,f=a.defer();return c.post("/api/profiles/"+b.id+"/cancel",{user:b.demand._owner,device:b.demand._id}).success(function(a){return f.resolve(a),e()}).error(function(a){return f.reject(a),e(a)}.bind(this)),f.promise},cancelRequest:function(b,d){var e=d||angular.noop,f=a.defer();return c.post("/api/profiles/"+b.id+"/cancel",{user:b.demand.user._id,device:b.demand.device._id,options:"request"}).success(function(a){return f.resolve(a),e()}).error(function(a){return f.reject(a),e(a)}.bind(this)),f.promise},discard:function(b,d){var e=d||angular.noop,f=a.defer();return console.log("ici"),c.post("/api/profiles/"+b.id+"/discard",{user:b.demand.user._id,device:b.demand.device._id}).success(function(a){return f.resolve(a),e()}).error(function(a){return f.reject(a),e(a)}.bind(this)),f.promise},addDevice:function(b,d){var e=d||angular.noop,f=a.defer();return c.post("/api/users/"+g._id+"/devices",b).success(function(a){return f.resolve(a),e(a)}).error(function(a){return f.reject(a),e(a)}.bind(this)),f.promise},createDevice:function(b,d){this.config();var e=d||angular.noop;return c.post("https://api.orange.com/datavenue/v1/datasources",b,h).success(function(b){var d={},f=a.defer();return d.ds_id=b.id,d.name=b.name,d.description=b.description,d.serial=b.serial,d.group=[],d.group=b.group,d._constructor=g._id,c.post("/api/devices",d).success(function(a){return f.resolve(a),e()}).error(function(a){return f.reject(a),e(a)}.bind(this)),f.promise}).error(function(a){console.log(a)}.bind(this)).$promise},updateDevice:function(b,d){var e=d||angular.noop,f=a.defer();return c.patch("/api/devices/"+b._id,b).success(function(a){return f.resolve(a),e()}).error(function(a){return f.reject(a),e(a)}.bind(this)),f.promise},importDevice:function(b){var d=(b||angular.noop,a.defer());return this.config(),c.get("https://api.orange.com/datavenue/v1/datasources",h).success(function(b){angular.forEach(b,function(b){var e=a.defer(),f={};f.ds_id=b.id,f.name=b.name,f.description=b.description,f.serial=b.serial,f._constructor=g._id,f.group=b.group,f.streams=[],f.apikeys=[],a.all([c.get("https://api.orange.com/datavenue/v1/datasources/"+f.ds_id+"/streams",h).success(function(a){e.resolve(a)}),c.get("https://api.orange.com/datavenue/v1/datasources/"+f.ds_id+"/keys",h).success(function(a){e.resolve(a)})]).then(function(a){var b=[],e=[];if(a[1].data)for(var g in a[1].data)for(var h in a[1].data[g].rights)"GET"===a[1].data[g].rights[h]&&e.push(a[1].data[g].value);a[0].data&&angular.forEach(a[0].data,function(a){b.push({id:a.id,name:a.name,lastValue:a.lastValue?a.lastValue:{},values:a.lastValue?[{value:a.lastValue,time:new Date}]:[],lastPost:new Date})}),f.streams=b,f.apikeys=e,c.post("/api/devices",f).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)})})})}).error(function(a){console.log(a),d.reject(a)}),d.promise},importStDevice:function(b){this.config();var d=(b||angular.noop,a.defer());return console.log(g._id),c.get("/api/users/"+g._id+"/des").success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},removeDevice:function(){},deleteDevice:function(){},getCurrentDevices:function(){return f},clear:function(){f=[],h={}}}}]),angular.module("dascentApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:'<img ng-src="'+e[0].path+'"><p>Are you sure you want to delete <strong>'+e[0]+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}},browse:function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments);b=c({modal:{dismissable:!0,title:"Confirm upload",html:"<p>Are you sure you want to Upload the file ?</p>",buttons:[{classes:"btn-primary",text:"Create device",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-primary"),b.result.then(function(b){a.apply(b,d)})}},upload:function(a){return a=a||angular.noop,function(){{var b,d=Array.prototype.slice.call(arguments);d.shift()}b=c({modal:{dismissable:!0,title:"Confirm upload",html:'<p>Are you sure you want to Upload the file?</p>  <form class="form" ng-submit="createDevice(fileContent)" novalidate><input type="file" file-reader="fileContent" accept=".csv" required><button class="btn btn-success" type="submit">Create devices</button></form>',buttons:[{classes:"btn-primary",text:"Create device",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-primary"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("dascentApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("dascentApp").controller("NavbarCtrl",["$scope","$location","Auth","ManDev",function(a,b,c,d){a.menu=[{title:"My profile",link:"/moncompte"},{title:"My devices",link:"/device"},{title:"My followers",link:"/follower"}],a.isCollapsed=!0,a.isLoggedIn=c.isLoggedIn,a.isAdmin=c.isAdmin,a.isConstructor=c.isConstructor,a.getCurrentUser=c.getCurrentUser,a.logout=function(){c.logout(),d.clear(),b.path("/")},a.isActive=function(a){return a===b.path()}}]),angular.module("dascentApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):a._constructor===b[0]._constructor&&b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},syncProfileUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c="created";if(b.user===a.user)for(var e in b)if(b[e].length!==a[e].length&&(b[e].splice(0,b[e].length),0!==a[e].length))for(var f in a[e])b[e].push(a[e][f]);c="updated",d(c,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},syncDevUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c="created";console.log(b);for(var e in b)b[e].device.ds_id===a.ds_id&&(b[e].device=a);c="updated",d(c,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("dascentApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=row><div class="col-md-6 col-md-offset-3"><h2>Login Page</h2><form ng-controller=LoginCtrl class=form name=form ng-submit=login(form) novalidate><div ng-include="\'components/forms/login-form.html\'"></div></form><a>Forgotten your password?</a></div></div><hr></div>'),a.put("app/account/settings/settings.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class="row col-md-8 col-md-offset-1" ng-controller=SettingsCtrl><div class=row><div class=col-lg-3 ng-if=!isConstructor>Avatar:</div><div class=col-lg-3 ng-if=isConstructor>Logo:</div><div class=col-lg-5><div class=col-lg-3><img width=50 ng-src="/api/users/avatar/{{user.avatar}}"></div></div></div><div class=row><div class=col-lg-3>Choisir un avatar:</div><div class=col-lg-5><input id=file type=file ng-file-select accept="image/png, image/jpeg"> <span ng-if=uploadInProgress>Upload progress: {{ uploadProgress }}</span></div></div><br><div class=row ng-if=imageSrc><div class=col-lg-3>Preview:</div><div class=col-lg-5><div class=col-lg-3><img width=50 ng-src="{{imageSrc}}"></div><button type=submit ng-click=onFileSelect(files)>Ajouter</button></div></div><br><form name=form1 class=form><div class=row><div class=col-lg-3 ng-if=!isConstructor>Firstname:</div><div class=col-lg-3 ng-if=isConstructor>Company name:</div><div class=col-lg-5 ng-class="{ \'has-success\': form1.name.$valid && submitted,\n                                            \'has-error\': form1.name.$invalid && submitted }"><input name=name class=form-control ng-model=user.name required><p class=help-block ng-show=form1.name.$error.required>A name is required</p></div></div><br><div class=row ng-if=isConstructor><div class=col-lg-3>ISS KEY:</div><div ng-if=isConstructor class=col-lg-5 ng-class="{ \'has-success\': form1.name.$valid && submitted,\n                                            \'has-error\': form1.name.$invalid && submitted }"><input name=isskey class=form-control ng-model=user.isskey required><p class=help-block ng-show=form1.isskey.$error.required>A ISS is required</p></div></div><br><div class=row><div class=col-lg-3 ng-if=isConstructor>Orange APIGEE KEY:</div><div ng-if=isConstructor class=col-lg-5 ng-class="{ \'has-success\': form1.name.$valid && submitted,\n                                            \'has-error\': form1.name.$invalid && submitted }"><input name=apikey class=form-control ng-model=user.idclient required><p class=help-block ng-show=form1.isskey.$error.required>A Orange APIGEE is required</p></div></div><br><div class=row><div class=col-lg-3 ng-if=!isConstructor>Lastname:</div><div class=col-lg-3 ng-if=isConstructor>SIREN:</div><div ng-if=!isConstructor class=col-lg-5 ng-class="{ \'has-success\': form1.lastname.$valid && submitted,\n                                            \'has-error\': form1.lastname.$invalid && submitted }"><input name=lastname class=form-control ng-model=user.lastname required><p class=help-block ng-if="form1.lastname.$error.required && !isConstructor">A lastname is required</p><p class=help-block ng-if="form1.lastname.$error.required && isConstructor">A SIREN is required</p></div><div ng-if=isConstructor class=col-lg-5 ng-class="{ \'has-success\': form1.lastname.$valid && submitted,\n                                            \'has-error\': form1.lastname.$invalid && submitted }"><input name=lastname class=form-control ng-model=user.lastname></div></div><div class=row><div class=col-lg-3>Email:</div><div class=col-lg-5 ng-class="{ \'has-success\': form1.mail.$valid && submitted,\n                                            \'has-error\': form1.mail.$invalid && submitted }"><input name=mail type=email class=form-control ng-model=user.email required><p class=help-block ng-show=form1.mail.$error.required>An email is required</p></div></div></form><div class=row><div class=col-lg-3>Password:</div><div class=col-lg-5><a ng-hide=pwd role=button ng-click="pwd=true" ng-init="pwd=false">change password</a><div ng-show=pwd><form class=form name=form ng-submit=changePassword(form) novalidate><div class=form-group><label>Current Password</label><input type=password name=password class=form-control ng-model=user.oldPassword mongoose-error><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-primary" type=submit>Save password</button> <button class="btn btn-primary" type=button ng-click="pwd=false">Cancel</button></form></div><br></div></div><br><div class=row><div class="col-lg-5 col-lg-offset-3"><button class="btn btn-success" type=button ng-click=update(form1)>Save changes</button></div></div></div></div>'),
a.put("app/account/signup/signup-pro.html",'<div class=row ng-controller=SignupCtrl><div class=col-sm-12><form class=form name=form ng-submit=registerPro(form) novalidate><div class=row><div class="form-group col-md-4" ng-class="{ \'has-success\': form.name.$valid && submitted,\n                                            \'has-error\': form.name.$invalid && submitted }"><label>Company Name</label><input name=name class=form-control ng-model=user.name placeholder=Name required><p class=help-block ng-show="form.name.$error.required && submitted">A name is required</p></div></div><div class=row><div class="form-group col-md-3" ng-class="{ \'has-success\': form.isskey.$valid && submitted,\n                                            \'has-error\': form.isskey.$invalid && submitted }"><label>ISS KEY</label><input name=isskey class=form-control ng-model=user.isskey placeholder=ISS-Key required><p class=help-block ng-show="form.isskey.$error.required && submitted">A key is required</p></div><div class="form-group col-md-3" ng-class="{ \'has-success\': form.idclient.$valid && submitted,\n                                            \'has-error\': form.idclient.$invalid && submitted }"><label>CLIENT ID</label><input name=idclient class=form-control ng-model=user.idclient placeholder="CLIENT ID" required><p class=help-block ng-show="form.idclient.$error.required && submitted">A Client ID is required (APP Orange partner ID)</p></div></div><div class=row><div class="form-group col-md-6" ng-class="{ \'has-success\': form.email.$valid && submitted,\n                                            \'has-error\': form.email.$invalid && submitted }"><label>Email</label><input type=email name=email class=form-control ng-model=user.email required mongoose-error><p class=help-block ng-show="form.email.$error.email && submitted">Doesn\'t look like a valid email.</p><p class=help-block ng-show="form.email.$error.required && submitted">What\'s your email address?</p><p class=help-block ng-show=form.email.$error.mongoose>{{ errors.email }}</p></div></div><div class=row><div class="form-group col-md-3" ng-class="{ \'has-success\': form.password1.$valid && submitted,\n                                            \'has-error\': form.password1.$invalid && submitted }"><label>Password</label><input type=password name=password1 class=form-control ng-model=user.password1 ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password1.$error.minlength || form.password1.$error.required) && submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=form.password1.$error.mongoose>{{ errors.password }}</p></div><div class="form-group col-md-3" ng-class="{ \'has-success\': form.password2.$valid && submitted,\n                                            \'has-error\': form.password2.$invalid && submitted }"><label>Confirm password</label><input type=password name=password2 class=form-control ng-model=user.password2 ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password2.$error.minlength || form.password2.$error.required) && submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=form.password2.$error.mongoose>{{ errors.password }}</p></div></div><div class=row><div vc-recaptcha name=captcha class="form-group col-md-4" ng-class=has-success on-create=setWidgetId(widgetId) on-success=setResponse(response) theme=light key=key required></div><div class="form-group col-md-2" ng-class="{ \'has-error\': !response && submitted }"><p class=help-block ng-hide=response>Captcha required</p></div></div><div class=row><div class=col-md-2><button class="btn btn-login btn-success btn-block" type=submit>Sign up</button></div></div></form></div><hr></div>'),a.put("app/account/signup/signup.html",'<div class=row ng-controller=SignupCtrl><div class=col-sm-12><form class=form name=form ng-submit=register(form) novalidate><div class=row><div class="form-group col-md-3" ng-class="{ \'has-success\': form.name.$valid && submitted,\n                                            \'has-error\': form.name.$invalid && submitted }"><label>Firstname</label><input name=name class=form-control ng-model=user.name placeholder=Name required><p class=help-block ng-show="form.name.$error.required && submitted">A name is required</p></div><div class="form-group col-md-3" ng-class="{ \'has-success\': form.lastname.$valid && submitted,\n                                            \'has-error\': form.lastname.$invalid && submitted }"><label>Lastname</label><input name=lastname class=form-control ng-model=user.lastname placeholder=Lastname required><p class=help-block ng-show="form.lastname.$error.required && submitted">A lastname is required</p></div></div><div class=row><div class="form-group col-md-6" ng-class="{ \'has-success\': form.email.$valid && submitted,\n                                            \'has-error\': form.email.$invalid && submitted }"><label>Email</label><input type=email name=email class=form-control ng-model=user.email required mongoose-error><p class=help-block ng-show="form.email.$error.email && submitted">Doesn\'t look like a valid email.</p><p class=help-block ng-show="form.email.$error.required && submitted">What\'s your email address?</p><p class=help-block ng-show=form.email.$error.mongoose>{{ errors.email }}</p></div></div><div class=row><div class="form-group col-md-3" ng-class="{ \'has-success\': form.password1.$valid && submitted,\n                                            \'has-error\': form.password1.$invalid && submitted }"><label>Password</label><input type=password name=password1 class=form-control ng-model=user.password1 ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password1.$error.minlength || form.password1.$error.required) && submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=form.password1.$error.mongoose>{{ errors.password }}</p></div><div class="form-group col-md-3" ng-class="{ \'has-success\': form.password2.$valid && submitted,\n                                            \'has-error\': form.password2.$invalid && submitted }"><label>Confirm password</label><input type=password name=password2 class=form-control ng-model=user.password2 ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password2.$error.minlength || form.password2.$error.required) && submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=form.password2.$error.mongoose>{{ errors.password }}</p></div></div><div class=row><div vc-recaptcha name=captcha class="form-group col-md-4" ng-class=has-success on-create=setWidgetId(widgetId) on-success=setResponse(response) theme=light key=key required></div><div class="form-group col-md-2" ng-class="{ \'has-error\': !response && submitted }"><p class=help-block ng-hide=response>Captcha required</p></div></div><div class=row><div class=col-md-2><button class="btn btn-login btn-success btn-block" type=submit>Sign up</button></div></div></form></div><hr></div>'),a.put("app/main/main.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=bgimage><div class=row><div class=col-md-6><h1>Track your devices online</h1><p>The interaction network of things</p></div></div><div class=row><div class=col-md-6><h2>Create an account</h2>Provider: <input type=checkbox ng-model=checked ng-init="checked=false"><br><span ng-if=checked>This is reserved to device provider professional, please contact orange partner for more information</span></div></div><div ng-if=!checked ng-include="\'app/account/signup/signup.html\'"></div><div ng-if=checked ng-include="\'app/account/signup/signup-pro.html\'"></div></div></div><footer class=footer><div class=container></div></footer>'),a.put("app/profil/device/device.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div ng-include="\'components/sidebar/sidebar.html\'"></div><div class=col-md-8><div>Ajouter un device (Propriétaire): <input type=checkbox ng-model=checked ng-init="checked=false"><br><span ng-if=checked>This is reserved to the device owner, please contact orange partner for more information</span><div ng-if=!checked><form class=navbar-form name=addDevice class=form ng-submit=register()><label>Serial Number :</label><input name=serial ng-model=device.serial required> <button type=submit class="btn btn-success">Subscribe</button></form></div><div ng-if=checked><form class=navbar-form name=addDevice class=form ng-submit=registerO()><label>Serial Number :</label><input name=serial ng-model=device.serial required><label>PIN Code:</label><input name=serial type=password ng-model=device.pass required> <button type=submit class="btn btn-success">Ajouter</button></form></div></div><div><h4>Subscribed sensors</h4><div ng-show=!profile.watchs.length>Vous n\'avez pas de devices</div><div ng-hide=!profile.watchs.length class=list-group ng-repeat="watch in profile.watchs"><div class=list-group-item><a href=#><img src=assets/images/da438166.iot.jpg width=50 height=50 class="img-circle tt"></a> <a class=close ng-click=deleteDevice(watch)>×</a><h3 class=panel-title>Capteur :{{watch.device.name}}</h3>SN: {{watch.device.serial}} - Description: {{watch.device.description}}<h4 ng-if=type(watch) class="text-danger pull-right">Owner</h4><h4 ng-if=!type(watch) class="text-danger pull-right">subscribe</h4><button ng-if="isGPS(watch) && !watch.device.tracking" type=button ng-click=activateTracking(watch.device) class="btn-default pull-right">Activate Tracking</button> <button ng-if="isGPS(watch) && watch.device.tracking" type=button ng-click=deactivateTracking(watch.device) class="btn-default pull-right">Cancel Tracking</button></div></div><h4>Pending requests</h4><div ng-show=!profile.waiting.length>Vous n\'avez pas de demandes</div><div ng-hide=!profile.waiting.length class="panel panel-default" ng-repeat="device in profile.waiting"><div class=panel-body><div><a href=#><img src=assets/images/da438166.iot.jpg width=50 height=50 class="img-circle tt"></a><h3 class=panel-title>Capteur :{{device.name}}</h3></div>SN: {{device.serial}} - Description: {{device.description}} <button type=button ng-click=cancel(device) class="btn-default pull-right">Cancel request</button></div></div></div></div></div>'),a.put("app/profil/follower/follower.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><notifications-bar class=notifications></notifications-bar><div class=container><div ng-include="\'components/sidebar/sidebar.html\'"></div><div class=col-md-8><div><h4>Followers</h4><div ng-show=!profile.accepted.length>Vous n\'avez pas de followers</div><div ng-hide=!profile.accepted.length class="panel panel-default" ng-repeat="device in profile.accepted"><div class=panel-body><div><a href=#><img src=assets/images/da438166.iot.jpg width=50 height=50 class="img-circle tt"></a><h3 class=panel-title>{{device.user.name}}</h3></div>{{device.device.name}} / {{device.device.serial}} / {{device.device.description}} <button type=button ng-click=discard(device) class="btn-default pull-right">Discard</button></div></div><h4>Requests</h4><div ng-show=!profile.waitlist.length>Vous n\'avez pas de demandes en cours</div><div ng-hide=!profile.waitlist.length class="panel panel-default" ng-repeat="device in profile.waitlist"><div class=panel-body><div><a href=#><img src=assets/images/da438166.iot.jpg width=50 height=50 class="img-circle tt"></a><h3 class=panel-title>Ajouter un follower :{{device.user.name}}</h3></div>{{device.device.name}} / {{device.device.serial}} / {{device.device.description}} <button type=button ng-click=cancelR(device) class="btn-default pull-right">Delete request</button> <button type=button ng-click=confirm(device) class="btn-primary pull-right">Confirm</button></div></div></div></div></div>'),a.put("app/profil/moncompte/moncompte.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div ng-include="\'components/sidebar/sidebar.html\'"></div><div class="pullframe col-md-8"><div ng-if=!notif()>Vous n\'avez pas de notifications</div><div ng-if=notif()><div ng-repeat="watch in profile.watchs"><div ng-if=watch.device.tracking>{{watch.device.name}} : tracking mode activated</div></div></div><div ng-if="notif() && gps"><ui-gmap-google-map center=map.center zoom=map.zoom control=control><ui-gmap-markers models=points coords="\'coords\'" options="\'options\'" events="\'events\'"></ui-gmap-markers><ui-gmap-markers models=markers2 coords="\'self\'" icon="\'icon\'" click=onMarkerClicked options="\'options\'" events=map.markers2Events><ui-gmap-windows show="\'showWindow\'" closeclick="\'closeClick\'" ng-cloak></ui-gmap-windows></ui-gmap-markers><ui-gmap-polyline ng-repeat="p in polylines" path=p.path stroke=p.stroke visible fit=false editable=p.editable></ui-gmap-polyline></ui-gmap-google-map></div><div ng-if=notif() ng-repeat="watch in profile.watchs"><div ng-if="watch.device.group[0]!=\'GPS\'"><div ng-repeat="stream in watch.device.streams" ng-hide="stream.lastValue == null\n'+"      || stream.name=='Latitude' || stream.name=='command' || stream.name=='downlinkFcnt' || stream.name=='battery'\"><div class=\"panel panel-default\"><div class=panel-body><a href=#><img src=assets/images/da438166.iot.jpg width=50 height=50 class=\"img-circle tt\"><h2 class=panel-title>Device :{{watch.device.name}}</h2></a></div><div ng-if=\"watch.device.group=='LORA' && stream.name=='message'\" lora-reader=stream.lastValue></div><div ng-repeat=\"value in stream.values\">{{stream.name}} valeur : {{value.value}} le {{value.time | date:'dd.MM.yyyy à HH:mm:ss'}}</div></div></div></div></div></div></div>"),a.put("app/provider/constructor.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=col-md-12><div class=row><div class=col-md-6>Choose Backend - Default is Datavenue -> Standard IOTDM: <input type=checkbox ng-model=checked ng-init="checked=false"></div><div ng-if=checked class=col-md-6>This is an implementation of OneM2M, please contact Fatima for more information</div></div><br><div class=col-md-3><ul id=link class="nav nav-pills nav-stacked"><li id=link1 role=presentation class=active ng-model=toggle ng-click="toggle = true"><a href=# onclick="$(\'#link li\').removeClass(\'active\');$(\'#link1\').addClass(\'active\')">Dashboard</a></li><li id=link2 role=presentation ng-model=toggle ng-click="toggle = false"><a href=# onclick="$(\'#link li\').removeClass(\'active\');$(\'#link2\').addClass(\'active\')">Liste des devices</a></li></ul></div><div class=col-md-9><div class="row info"><!-- champ de sauvergarde et de mise à jour de l\'apikey--><div class=col-md-8><div class=input-group><label>Orange Partner Key : {{constructor().idclient}}</label></div><!-- champ de sauvergarde et de mise à jour de l\'isskey--><div class=input-group><label>ISS Key : {{constructor().isskey}}</label></div></div></div><!-- boutons de sauvergarde et de mise à jour des datasources--><div class=row><div class=col-md-8><form name=upload class=form ng-submit=createDevice(fileContent) ng-if=!checked><div class=col-md-6><input name=file type=file file-reader=fileContent accept=.csv ng-model=file required></div><p class=help-block ng-show=file>A file is required</p><div class=col-md-6><button class="btn btn-success" type=submit>Create devices</button></div></form></div><div class=col-md-4><form ng-submit=getDevices() ng-if=!checked><button ng-hide=devices.length class="btn btn-success" type=submit>Import devices</button> <button ng-show=devices.length class="btn btn-success" type=submit>Update devices</button></form><form ng-submit=getStDevices() ng-if=checked><button ng-hide=devices.length class="btn btn-success" type=submit>Import devices</button> <button ng-show=devices.length class="btn btn-success" type=submit>Update devices</button></form></div></div><div id=dashboard class=row ng-if=toggle><h2>Graphe d\'utilisation des devices</h2><div ng-show=!devices.length>Aucun device declaré</div><chart ng-if=devices.length chart-data=devices></chart></div><div id=list ng-show=!toggle><h2>Liste des devices</h2><div ng-show=!devices.length>Aucun device declaré</div><div ng-hide=!devices.length><div id=chart></div><table class="table table-striped table-bordered" data-cache=false data-height=299><thead><tr><th></th><th>Serial</th><th>Datasource ID</th><th>Name</th><th>Description</th><th>State</th><th>Group</th><th></th></tr></thead><tr ng-repeat="device in devices"><td>{{$index+1}}</td><td>{{device.serial}}</td><td>{{device.ds_id}}</td><td>{{device.name}}</td><td>{{device.description}}</td><td><div ng-if="!device.hasOwnProperty(\'_owner\')" class=red></div><div ng-if="device.hasOwnProperty(\'_owner\')" class=green></div></td><td>{{device.group[0]}}</td><td><a ng-click=delete(device) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></td></tr></table></div></div></div></div></div>'),a.put("components/forms/login-form.html",'<div class=form-group ng-class="{ \'has-success\': form.mail.$valid && submitted,\n                                            \'has-error\': form.mail.$invalid && submitted }"><label class=sr-only>Email</label><input type=email name=mail class=form-control ng-model=user.mail placeholder=email required><p class=help-block ng-show="form.mail.$error.required && submitted">An email is required</p></div><div class=form-group ng-class="{ \'has-success\': form.pword.$valid && submitted,\n                                            \'has-error\': form.pword.$invalid && submitted }"><label class=sr-only>Password</label><input type=password name=pword class=form-control ng-model=user.pword placeholder=password required><p class=help-block ng-show="form.pword.$error.required && submitted">A password is required</p></div><button type=submit class="btn btn-login btn-default">Login</button><p ng-hide="isActive(\'/\')">or <a href="/"><strong>Sign up for Dascent</strong></a></p><div class="form-group has-error"><p class=help-block>{{ errors.other }}</p></div>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button></div><a href=/moncompte class=navbar-brand><span class="glyphicon glyphicon-home"></span> <strong>D-Ascent</strong></a><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-show="isLoggedIn() && !isAdmin() && !isConstructor()" ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(\'/admin\')}"><a href=/admin>Admin</a></li><li ng-show=isConstructor() ng-class="{active: isActive(\'/constructor\')}"><a href=/constructor>Provider-Dashboard</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-hide="isLoggedIn() || isActive(\'/login\') "><form ng-controller=LoginCtrl class="navbar-form navbar-right" name=form ng-submit=login(form) novalidate><div ng-include="\'components/forms/login-form.html\'"></div></form></li><li ng-show=isLoggedIn()><p class=navbar-text>Hello {{ getCurrentUser().name }}</p></li><li ng-show=isLoggedIn() ng-class="{active: isActive(\'/settings\')}"><a href=/settings><span class="glyphicon glyphicon-cog"></span></a></li><li ng-show=isLoggedIn() ng-class="{active: isActive(\'/logout\')}"><a href="" ng-click=logout()>Logout</a></li></ul></div></div></div>'),a.put("components/sidebar/sidebar.html",'<div class="col-md-3 col-md-offset-1"><div class=list-group><a class="list-group-item active" href=#><span class=badge>{{currentUser().name}}</span> <img ng-src=/api/users/avatar/{{currentUser().avatar}} width=50 height=50 alt=... class="img-circle thumbnail"></a> <a class=list-group-item href=/device><span class=badge>{{profile.watchs.length}}</span> <span ng-if=profile.waiting.length class="badge badge-important">{{profile.waiting.length}}</span>Devices</a> <a class=list-group-item href=/follower><span class=badge>{{profile.accepted.length}}</span> <span ng-if=profile.waitlist.length class="badge badge-important">{{profile.waitlist.length}}</span>Followers</a> <a class=list-group-item href=/follower><span class=badge>{{followings.length}}</span>Following</a></div></div>')}]);